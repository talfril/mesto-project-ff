(()=>{"use strict";var e,t=document.querySelectorAll(".popup");function r(t){t.classList.add("popup_is-opened"),e=function(e){!function(e,t){"Escape"===e.key&&n(t)}(e,t)},document.addEventListener("keydown",e)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}var o,a=document.querySelector(".popup_type_image"),c=a.querySelector(".popup__image"),i=a.querySelector(".popup__caption");function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l="https://nomoreparties.co/v1/wff-cohort-2",s={headers:{authorization:"c1324e8c-3ffd-41bf-8d8d-d39bc9277f92","Content-Type":"application/json"}};function d(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function p(e,t){return fetch(e,t).then(d)}function f(e){return p("".concat(l,"/cards/likes/").concat(e),{method:"PUT",headers:s.headers,body:JSON.stringify({})})}function y(e){return p("".concat(l,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers,body:JSON.stringify({})})}function _(e,t){if(t&&t.classList.contains("popup__button")){var r=e?"Сохранение...":"Сохранить";t.textContent=r}}var m=document.querySelector(".places__list"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector("#card-template").content,S=document.forms.newPlace,b=S.querySelector(".popup__input_type_card-name"),q=S.querySelector(".popup__input_type_url");function g(e,t,n,o){var u=h.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__delete-button"),s=u.querySelector(".card__image"),d=u.querySelector(".card__title"),p=u.querySelector(".card__like-button"),f=u.querySelector(".likes-number"),y=e._id||"";return u.dataset.cardId=y,e.owner&&e.owner._id===o?l.style.display="block":l.style.display="none",e.likes&&e.likes.some((function(e){return e._id===o}))&&p.classList.add("card__like-button_is-active"),s.src=e.link,s.alt="Фотография с места - "+e.name,d.textContent=e.name,f.textContent=e.likes.length,l.addEventListener("click",t),p.addEventListener("click",(function(){n(y)})),s.addEventListener("click",(function(){var t,n;t=e.link,n=e.name,c.src=t,c.alt=n,i.textContent=n,r(a)})),u}function E(e){var t,r=e.target.closest(".card");(t=r.dataset.cardId,p("".concat(l,"/cards/").concat(t),{method:"DELETE",headers:s.headers})).then((function(){r.remove()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}function k(e){var t=document.querySelector(".card[data-card-id='".concat(e,"']")),r=t.querySelector(".card__like-button"),n=r.classList.contains("card__like-button_is-active");(n?y:f)(e).then((function(e){r.classList.toggle("card__like-button_is-active"),t.querySelector(".likes-number").textContent=e.likes.length,t.dataset.isLiked=n?"false":"true"})).catch((function(e){console.log("Ошибка при обработке лайка/дизлайка: ".concat(e))}))}var C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",errorSelector:function(e){return"[data-error-for='".concat(e,"']")}},L=function(e,t,r){var n=e.querySelector(r.errorSelector(t.id));n&&(t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent="")};function A(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);w(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?L(e,t,r):function(e,t,r,n){var o=e.querySelector(n.errorSelector(t.id));o&&(t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass))}(e,t,t.validationMessage,r)}(e,o,t),w(r,n,t)}))}))}function w(e,t,r){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled",!0))}var x=document.querySelector(".popup_type_edit"),D=document.querySelector(".profile__edit-button"),O=document.querySelector(".profile__add-button"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),j=document.forms.editProfile,B=j.querySelector(".popup__input_type_name"),I=j.querySelector(".popup__input_type_description");function N(){B.value=P.textContent,I.value=T.textContent;var e=new Event("input",{bubbles:!0});B.dispatchEvent(e),I.dispatchEvent(e)}D.addEventListener("click",(function(){N(),r(x)})),N();var J,M=document.querySelector(".profile__image"),H=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_new-avatar"),V=document.forms.changeAvatar,z=V.querySelector(".popup__input_type_avatar_url");H.addEventListener("click",(function(){r(U)})),j.addEventListener("submit",(function(e){e.preventDefault();var t,r,o=e.target.querySelector(".popup__button");_(!0,o),(t=B.value,r=I.value,p("".concat(l,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:r})})).then((function(){P.textContent=B.value,T.textContent=I.value,n(x),j.reset()})).catch((function(e){console.log("Ошибка: ".concat(e))})).finally((function(){_(!1,o)}))})),newPlace.addEventListener("submit",(function(e){e.preventDefault();var t,r,a=e.submitter;_(!0,a),(t=b.value,r=q.value,p("".concat(l,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:t,link:r})})).then((function(e){var t=g(e,E,k,o);m.insertBefore(t,m.firstChild),S.reset(),n(v)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){_(!1,a)}))})),V.addEventListener("submit",(function(e){e.preventDefault();var t=V.querySelector(".popup__button"),r=z.value;_(!0,t),function(e){return p("".concat(l,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})})}(r).then((function(){M.style.backgroundImage="url('".concat(r,"')"),n(U),V.reset(),function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(r){L(e,r,t)}));var r=e.querySelector(t.submitButtonSelector);r.classList.add(t.inactiveButtonClass),r.setAttribute("disabled",!0)}(V,C),A(V,C)})).catch((function(e){console.error("Ошибка при сохранении аватара:",e)})).finally((function(){_(!1,t)}))})),t.forEach((function(e){e.addEventListener("click",(function(t){(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&n(e)}))})),J=v,O.addEventListener("click",(function(){r(J)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),A(t,e)}))}(C),Promise.all([p("".concat(l,"/users/me"),{headers:s.headers}).then((function(e){return o=e._id,{name:e.name,about:e.about,avatar:"url('".concat(e.avatar,"')"),_id:o}})),p("".concat(l,"/cards"),{headers:s.headers}).then((function(e){return Array.from(e)}))]).then((function(e){var t,r,n=(r=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,c,i=[],u=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw o}}return i}}(t,r)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{userData:n[0],cardsData:n[1]}})).then((function(e){var t=e.userData,r=e.cardsData;P.textContent=t.name,T.textContent=t.about,M.style.backgroundImage=t.avatar,function(e){e.forEach((function(e){var t=g(e,E,k,o);m.appendChild(t)}))}(r)})).catch((function(e){console.error("Ошибка при получении данных пользователя:",e)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U1gsT0Y3QzNDLFNBQWtCWSxHQUN2QkEsRUFBVTVELFNBQVEsU0FBVXpELEdBQzFCLElBQU1zSCxFQUFPdkgsRUFBV0MsRUFBT3VCLEVBQVlRLEVBQVUzRSxHQUNyRG1DLEVBQVlnSSxZQUFZRCxFQUMxQixHQUNGLENFMENJRSxDQUFTSCxFQUNYLElBQ0MxRixPQUFNLFNBQUM0RSxHQUNOMUUsUUFBUTBFLE1BQU0sNENBQTZDQSxFQUM3RCxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWFuZGV4X3ByYWt0aWt1bS8uL3NyYy9zY3JpcHRzL21vZGFsLmpzIiwid2VicGFjazovL3lhbmRleF9wcmFrdGlrdW0vLi9zcmMvc2NyaXB0cy9hcGkuanMiLCJ3ZWJwYWNrOi8veWFuZGV4X3ByYWt0aWt1bS8uL3NyYy9zY3JpcHRzL3V0aWxzLmpzIiwid2VicGFjazovL3lhbmRleF9wcmFrdGlrdW0vLi9zcmMvc2NyaXB0cy9jYXJkLmpzIiwid2VicGFjazovL3lhbmRleF9wcmFrdGlrdW0vLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3lhbmRleF9wcmFrdGlrdW0vLi9zcmMvc2NyaXB0cy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwJyk7XHJcbmxldCBlc2NDYWxsYmFjaztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvcGVuUG9wdXAocG9wdXApIHtcclxuICBwb3B1cC5jbGFzc0xpc3QuYWRkKCdwb3B1cF9pcy1vcGVuZWQnKTtcclxuICBlc2NDYWxsYmFjayA9IGZ1bmN0aW9uIChldnQpIHtcclxuICAgIGNsb3NlUG9wYXBFc2MoZXZ0LCBwb3B1cCk7XHJcbiAgfTtcclxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZXNjQ2FsbGJhY2spO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VQb3B1cChwb3B1cCkge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlc2NDYWxsYmFjayk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlUG9wYXBFc2MoZXZ0LCBwb3B1cCkge1xyXG4gIGlmIChldnQua2V5ID09PSAnRXNjYXBlJykge1xyXG4gICAgY2xvc2VQb3B1cChwb3B1cCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb3BlblBvcHVwQnlCdXR0b24oYnV0dG9uLCBwb3B1cCkge1xyXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9wZW5Qb3B1cChwb3B1cCk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8v0L7RgtC60YDRi9GC0LjQtSDQv9C+0L/QsNC/0LAg0LjQt9C+0LHRgNCw0LbQtdC90LjRj1xyXG5jb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfaW1hZ2UnKTtcclxuY29uc3QgcG9wdXBJbWFnZUltYWdlID0gcG9wdXBJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2ltYWdlJyk7XHJcbmNvbnN0IHBvcHVwSW1hZ2VDYXB0aW9uID0gcG9wdXBJbWFnZS5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvcGVuSW1hZ2VQb3B1cChsaW5rLCBhbHQpIHtcclxuICBwb3B1cEltYWdlSW1hZ2Uuc3JjID0gbGluaztcclxuICBwb3B1cEltYWdlSW1hZ2UuYWx0ID0gYWx0O1xyXG4gIHBvcHVwSW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gYWx0O1xyXG4gIG9wZW5Qb3B1cChwb3B1cEltYWdlKTtcclxufVxyXG4iLCJleHBvcnQgbGV0IGN1cnJlbnRVc2VySWQ7XHJcbmNvbnN0IGJhc2VVcmwgPSAnaHR0cHM6Ly9ub21vcmVwYXJ0aWVzLmNvL3YxL3dmZi1jb2hvcnQtMic7XHJcbmNvbnN0IGF1dGhvcml6YXRpb25Ub2tlbiA9ICdjMTMyNGU4Yy0zZmZkLTQxYmYtOGQ4ZC1kMzliYzkyNzdmOTInO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246IGF1dGhvcml6YXRpb25Ub2tlbixcclxuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgfSxcclxufTtcclxuXHJcbmZ1bmN0aW9uIGNoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgaWYgKCFyZXMub2spIHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChg0J7RiNC40LHQutCwOiAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgfVxyXG4gIHJldHVybiByZXMuanNvbigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZXF1ZXN0KHVybCwgb3B0aW9ucykge1xyXG4gIHJldHVybiBmZXRjaCh1cmwsIG9wdGlvbnMpLnRoZW4oY2hlY2tSZXNwb25zZSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhdXRob3JpemVVc2VyKCkge1xyXG4gIHJldHVybiByZXF1ZXN0KGAke2Jhc2VVcmx9L3VzZXJzL21lYCwgeyBoZWFkZXJzOiBjb25maWcuaGVhZGVycyB9KS50aGVuKFxyXG4gICAgKHJlc3VsdCkgPT4ge1xyXG4gICAgICBjdXJyZW50VXNlcklkID0gcmVzdWx0Ll9pZDtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBuYW1lOiByZXN1bHQubmFtZSxcclxuICAgICAgICBhYm91dDogcmVzdWx0LmFib3V0LFxyXG4gICAgICAgIGF2YXRhcjogYHVybCgnJHtyZXN1bHQuYXZhdGFyfScpYCxcclxuICAgICAgICBfaWQ6IGN1cnJlbnRVc2VySWQsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhcmRzRnJvbVNlcnZlcigpIHtcclxuICByZXR1cm4gcmVxdWVzdChgJHtiYXNlVXJsfS9jYXJkc2AsIHsgaGVhZGVyczogY29uZmlnLmhlYWRlcnMgfSkudGhlbihcclxuICAgIChyZXN1bHQpID0+IHtcclxuICAgICAgY29uc3QgaW5pdGlhbENhcmRzRnJvbVNlcnZlciA9IEFycmF5LmZyb20ocmVzdWx0KTtcclxuICAgICAgcmV0dXJuIGluaXRpYWxDYXJkc0Zyb21TZXJ2ZXI7XHJcbiAgICB9XHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHB1c2hNeUF1dGhvcml6YXRpb25Ub1NlcnZlcihuYW1lLCBkZXNjcmlwdGlvbikge1xyXG4gIHJldHVybiByZXF1ZXN0KGAke2Jhc2VVcmx9L3VzZXJzL21lYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgIGFib3V0OiBkZXNjcmlwdGlvbixcclxuICAgIH0pLFxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcHVzaE15Q2FyZFRvU2VydmVyKGNhcmROYW1lLCBjYXJkTGluaykge1xyXG4gIHJldHVybiByZXF1ZXN0KGAke2Jhc2VVcmx9L2NhcmRzYCwge1xyXG4gICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbmFtZTogY2FyZE5hbWUsXHJcbiAgICAgIGxpbms6IGNhcmRMaW5rLFxyXG4gICAgfSksXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVDYXJkT25TZXJ2ZXIoY2FyZElkKSB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYCR7YmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xyXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcclxuICAgIGhlYWRlcnM6IGNvbmZpZy5oZWFkZXJzLFxyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbGlrZUNhcmRPblNlcnZlcihjYXJkSWQpIHtcclxuICByZXR1cm4gcmVxdWVzdChgJHtiYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7fSksXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBkaXNMaWtlQ2FyZE9uU2VydmVyKGNhcmRJZCkge1xyXG4gIHJldHVybiByZXF1ZXN0KGAke2Jhc2VVcmx9L2NhcmRzL2xpa2VzLyR7Y2FyZElkfWAsIHtcclxuICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHt9KSxcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXJBdmF0YXIoYXZhdGFyVXJsKSB7XHJcbiAgcmV0dXJuIHJlcXVlc3QoYCR7YmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogYXZhdGFyVXJsLFxyXG4gICAgfSksXHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmZXRjaFVzZXJEYXRhQW5kQ2FyZHMoKSB7XHJcbiAgcmV0dXJuIFByb21pc2UuYWxsKFthdXRob3JpemVVc2VyKCksIGdldENhcmRzRnJvbVNlcnZlcigpXSkudGhlbihcclxuICAgIChbdXNlckRhdGEsIGNhcmRzRGF0YV0pID0+IHtcclxuICAgICAgcmV0dXJuIHsgdXNlckRhdGEsIGNhcmRzRGF0YSB9O1xyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuIiwiZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nLCBidXR0b24pIHtcclxuICAgIGlmIChidXR0b24gJiYgYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygncG9wdXBfX2J1dHRvbicpKSB7XHJcbiAgICAgIGNvbnN0IGJ1dHRvblRleHQgPSBpc0xvYWRpbmcgPyAn0KHQvtGF0YDQsNC90LXQvdC40LUuLi4nIDogJ9Ch0L7RhdGA0LDQvdC40YLRjCc7XHJcbiAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGJ1dHRvblRleHQ7XHJcbiAgICB9XHJcbiAgfSIsImltcG9ydCB7IGNsb3NlUG9wdXAsIG9wZW5JbWFnZVBvcHVwIH0gZnJvbSAnLi9tb2RhbC5qcyc7XHJcbmltcG9ydCB7XHJcbiAgcHVzaE15Q2FyZFRvU2VydmVyLFxyXG4gIGN1cnJlbnRVc2VySWQsXHJcbiAgZGVsZXRlQ2FyZE9uU2VydmVyLFxyXG4gIGxpa2VDYXJkT25TZXJ2ZXIsXHJcbiAgZGlzTGlrZUNhcmRPblNlcnZlcixcclxufSBmcm9tICcuL2FwaS5qcyc7XHJcbmltcG9ydCB7IHJlbmRlckxvYWRpbmcgfSBmcm9tICcuL3V0aWxzLmpzJztcclxuXHJcbmV4cG9ydCBjb25zdCBjYXJkc09uUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGFjZXNfX2xpc3QnKTtcclxuZXhwb3J0IGNvbnN0IHBvcHVwQWRkTmV3Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX25ldy1jYXJkJyk7XHJcblxyXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2FyZC10ZW1wbGF0ZScpLmNvbnRlbnQ7XHJcbmNvbnN0IG5ld1BsYWNlID0gZG9jdW1lbnQuZm9ybXMubmV3UGxhY2U7XHJcbmNvbnN0IHBsYWNlTmFtZSA9IG5ld1BsYWNlLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW5wdXRfdHlwZV9jYXJkLW5hbWUnKTtcclxuY29uc3QgcGxhY2VMaW5rID0gbmV3UGxhY2UucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbnB1dF90eXBlX3VybCcpO1xyXG5cclxuLy8g0KTRg9C90LrRhtC40Y8g0YHQvtC30LTQsNC90LjRjyDQutCw0YDRgtC+0YfQutC4XHJcbmZ1bmN0aW9uIGNyZWF0ZUNhcmQocGxhY2UsIGRlbGV0ZUZ1bmN0aW9uLCBsaWtlRnVuY3Rpb24sIGN1cnJlbnRVc2VySWQpIHtcclxuICBjb25zdCBjYXJkSXRlbSA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuY2FyZCcpLmNsb25lTm9kZSh0cnVlKTtcclxuICBjb25zdCBkZWxldGVCdXR0b24gPSBjYXJkSXRlbS5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRJdGVtLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19pbWFnZScpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmRJdGVtLnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gY2FyZEl0ZW0ucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgY29uc3QgbnVtYmVyT2ZMaWtlcyA9IGNhcmRJdGVtLnF1ZXJ5U2VsZWN0b3IoJy5saWtlcy1udW1iZXInKTtcclxuXHJcbiAgY29uc3QgY2FyZElkID0gcGxhY2UuX2lkIHx8ICcnO1xyXG4gIGNhcmRJdGVtLmRhdGFzZXQuY2FyZElkID0gY2FyZElkO1xyXG5cclxuICBpZiAocGxhY2Uub3duZXIgJiYgcGxhY2Uub3duZXIuX2lkID09PSBjdXJyZW50VXNlcklkKSB7XHJcbiAgICBkZWxldGVCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRlbGV0ZUJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gIH1cclxuICBpZiAocGxhY2UubGlrZXMgJiYgcGxhY2UubGlrZXMuc29tZSgodXNlcikgPT4gdXNlci5faWQgPT09IGN1cnJlbnRVc2VySWQpKSB7XHJcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxuICB9XHJcbiAgY2FyZEltYWdlLnNyYyA9IHBsYWNlLmxpbms7XHJcbiAgY2FyZEltYWdlLmFsdCA9ICfQpNC+0YLQvtCz0YDQsNGE0LjRjyDRgSDQvNC10YHRgtCwIC0gJyArIHBsYWNlLm5hbWU7XHJcbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gcGxhY2UubmFtZTtcclxuICBudW1iZXJPZkxpa2VzLnRleHRDb250ZW50ID0gcGxhY2UubGlrZXMubGVuZ3RoO1xyXG4gIGRlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRlbGV0ZUZ1bmN0aW9uKTtcclxuICBjYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIGxpa2VGdW5jdGlvbihjYXJkSWQpO1xyXG4gIH0pO1xyXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9wZW5JbWFnZVBvcHVwKHBsYWNlLmxpbmssIHBsYWNlLm5hbWUpO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gY2FyZEl0ZW07XHJcbn1cclxuXHJcbi8vINCk0YPQvdC60YbQuNGPINGD0LTQsNC70LXQvdC40Y8g0LrQsNGA0YLQvtGH0LrQuFxyXG5mdW5jdGlvbiBkZWxldGVDYXJkKGV2dCkge1xyXG4gIGNvbnN0IGNhcmRUb1JlbW92ZSA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmNhcmQnKTtcclxuICBjb25zdCBjYXJkSWQgPSBjYXJkVG9SZW1vdmUuZGF0YXNldC5jYXJkSWQ7XHJcbiAgZGVsZXRlQ2FyZE9uU2VydmVyKGNhcmRJZClcclxuICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgY2FyZFRvUmVtb3ZlLnJlbW92ZSgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDQntGI0LjQsdC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8vINCk0YPQvdC60YbQuNGPINC70LDQudC60LAv0LTQuNC30LvQsNC50LrQsCDQutCw0YDRgtC+0YfQutC4XHJcbmV4cG9ydCBmdW5jdGlvbiBsaWtlQ2FyZChjYXJkSWQpIHtcclxuICBjb25zdCBjdXJyZW50Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5jYXJkW2RhdGEtY2FyZC1pZD0nJHtjYXJkSWR9J11gKTtcclxuICBjb25zdCBjYXJkVG9MaWtlID0gY3VycmVudENhcmQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgY29uc3QgaXNMaWtlZCA9IGNhcmRUb0xpa2UuY2xhc3NMaXN0LmNvbnRhaW5zKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxuICBjb25zdCBsaWtlQWN0aW9uID0gaXNMaWtlZCA/IGRpc0xpa2VDYXJkT25TZXJ2ZXIgOiBsaWtlQ2FyZE9uU2VydmVyO1xyXG4gIGxpa2VBY3Rpb24oY2FyZElkKVxyXG4gICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XHJcbiAgICAgIGNhcmRUb0xpa2UuY2xhc3NMaXN0LnRvZ2dsZSgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgICAgIGNvbnN0IGxpa2VzTnVtYmVyRWxlbWVudCA9IGN1cnJlbnRDYXJkLnF1ZXJ5U2VsZWN0b3IoJy5saWtlcy1udW1iZXInKTtcclxuICAgICAgbGlrZXNOdW1iZXJFbGVtZW50LnRleHRDb250ZW50ID0gdXBkYXRlZENhcmQubGlrZXMubGVuZ3RoO1xyXG4gICAgICBjdXJyZW50Q2FyZC5kYXRhc2V0LmlzTGlrZWQgPSBpc0xpa2VkID8gJ2ZhbHNlJyA6ICd0cnVlJztcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhg0J7RiNC40LHQutCwINC/0YDQuCDQvtCx0YDQsNCx0L7RgtC60LUg0LvQsNC50LrQsC/QtNC40LfQu9Cw0LnQutCwOiAke2Vycn1gKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vLyDQktGL0LLQtdGB0YLQuCDQutCw0YDRgtC+0YfQutC4INC90LAg0YHRgtGA0LDQvdC40YbRg1xyXG5leHBvcnQgZnVuY3Rpb24gYWRkQ2FyZHMoY2FyZHNEYXRhKSB7XHJcbiAgY2FyZHNEYXRhLmZvckVhY2goZnVuY3Rpb24gKHBsYWNlKSB7XHJcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlQ2FyZChwbGFjZSwgZGVsZXRlQ2FyZCwgbGlrZUNhcmQsIGN1cnJlbnRVc2VySWQpO1xyXG4gICAgY2FyZHNPblBhZ2UuYXBwZW5kQ2hpbGQoY2FyZCk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8vINCU0L7QsdCw0LLQu9C10L3QuNC1INC90L7QstC+0Lkg0LrQsNGA0YLQvtGH0LrQuCDRh9C10YDQtdC3INC/0L7Qv9Cw0L9cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZENhcmRUb0NhcmRzQXJyYXkoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XHJcbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzYXZlQnV0dG9uKTtcclxuICBwdXNoTXlDYXJkVG9TZXJ2ZXIocGxhY2VOYW1lLnZhbHVlLCBwbGFjZUxpbmsudmFsdWUpXHJcbiAgICAudGhlbigoYWRkZWRDYXJkKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1BsYWNlQ2FyZCA9IGNyZWF0ZUNhcmQoXHJcbiAgICAgICAgYWRkZWRDYXJkLFxyXG4gICAgICAgIGRlbGV0ZUNhcmQsXHJcbiAgICAgICAgbGlrZUNhcmQsXHJcbiAgICAgICAgY3VycmVudFVzZXJJZFxyXG4gICAgICApO1xyXG4gICAgICBjYXJkc09uUGFnZS5pbnNlcnRCZWZvcmUobmV3UGxhY2VDYXJkLCBjYXJkc09uUGFnZS5maXJzdENoaWxkKTtcclxuICAgICAgbmV3UGxhY2UucmVzZXQoKTtcclxuICAgICAgY2xvc2VQb3B1cChwb3B1cEFkZE5ld0NhcmQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgY29uc29sZS5lcnJvcign0J7RiNC40LHQutCwINC/0YDQuCDQtNC+0LHQsNCy0LvQtdC90LjQuCDQutCw0YDRgtC+0YfQutC4OicsIGVycm9yKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHJlbmRlckxvYWRpbmcoZmFsc2UsIHNhdmVCdXR0b24pO1xyXG4gICAgfSk7XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XHJcbiAgZm9ybVNlbGVjdG9yOiAnLnBvcHVwX19mb3JtJyxcclxuICBpbnB1dFNlbGVjdG9yOiAnLnBvcHVwX19pbnB1dCcsXHJcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcucG9wdXBfX2J1dHRvbicsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogJ3BvcHVwX19idXR0b25fZGlzYWJsZWQnLFxyXG4gIGlucHV0RXJyb3JDbGFzczogJ3BvcHVwX19pbnB1dF90eXBlX2Vycm9yJyxcclxuICBlcnJvckNsYXNzOiAncG9wdXBfX2Vycm9yX3Zpc2libGUnLFxyXG4gIGVycm9yU2VsZWN0b3I6IChpbnB1dElkKSA9PiBgW2RhdGEtZXJyb3ItZm9yPScke2lucHV0SWR9J11gLFxyXG59O1xyXG5cclxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoXHJcbiAgZm9ybUVsZW1lbnQsXHJcbiAgaW5wdXRFbGVtZW50LFxyXG4gIGVycm9yTWVzc2FnZSxcclxuICB2YWxpZGF0aW9uQ29uZmlnXHJcbikgPT4ge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnLmVycm9yU2VsZWN0b3IoaW5wdXRFbGVtZW50LmlkKVxyXG4gICk7XHJcbiAgaWYgKGVycm9yRWxlbWVudCkge1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5lcnJvckNsYXNzKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSA9PiB7XHJcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIHZhbGlkYXRpb25Db25maWcuZXJyb3JTZWxlY3RvcihpbnB1dEVsZW1lbnQuaWQpXHJcbiAgKTtcclxuICBpZiAoZXJyb3JFbGVtZW50KSB7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XHJcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh2YWxpZGF0aW9uQ29uZmlnLmVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gJyc7XHJcbiAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpIHtcclxuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnBhdHRlcm5NaXNtYXRjaCkge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KGlucHV0RWxlbWVudC5kYXRhc2V0LmVycm9yTWVzc2FnZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XHJcbiAgfVxyXG5cclxuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xyXG4gICAgc2hvd0lucHV0RXJyb3IoXHJcbiAgICAgIGZvcm1FbGVtZW50LFxyXG4gICAgICBpbnB1dEVsZW1lbnQsXHJcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcclxuICAgICAgdmFsaWRhdGlvbkNvbmZpZ1xyXG4gICAgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpIHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxyXG4gICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uQ29uZmlnLmlucHV0U2VsZWN0b3IpXHJcbiAgKTtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgIHZhbGlkYXRpb25Db25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3JcclxuICApO1xyXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goZnVuY3Rpb24gKGlucHV0RWxlbWVudCkge1xyXG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZykge1xyXG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShcclxuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5mb3JtU2VsZWN0b3IpXHJcbiAgKTtcclxuICBmb3JtTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmb3JtRWxlbWVudCkge1xyXG4gICAgZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9KTtcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyVmFsaWRhdGlvbihmb3JtRWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZykge1xyXG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXHJcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuaW5wdXRTZWxlY3RvcilcclxuICApO1xyXG5cclxuICBpbnB1dExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaW5wdXRFbGVtZW50KSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICB2YWxpZGF0aW9uQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXHJcbiAgKTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICBidXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xyXG4gIHJldHVybiBpbnB1dExpc3Quc29tZShmdW5jdGlvbiAoaW5wdXRFbGVtZW50KSB7XHJcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSB7XHJcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIHRydWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgIGJ1dHRvbkVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgJy4uL3BhZ2VzL2luZGV4LmNzcyc7XHJcbmltcG9ydCB7IGFkZENhcmRzLCBhZGRDYXJkVG9DYXJkc0FycmF5LCBwb3B1cEFkZE5ld0NhcmQgfSBmcm9tICcuL2NhcmQuanMnO1xyXG5pbXBvcnQgeyBvcGVuUG9wdXAsIGNsb3NlUG9wdXAsIG9wZW5Qb3B1cEJ5QnV0dG9uLCBwb3B1cHMgfSBmcm9tICcuL21vZGFsLmpzJztcclxuaW1wb3J0IHtcclxuICBlbmFibGVWYWxpZGF0aW9uLFxyXG4gIHZhbGlkYXRpb25Db25maWcsXHJcbiAgc2V0RXZlbnRMaXN0ZW5lcnMsXHJcbiAgY2xlYXJWYWxpZGF0aW9uLFxyXG59IGZyb20gJy4vdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB7XHJcbiAgcHVzaE15QXV0aG9yaXphdGlvblRvU2VydmVyLFxyXG4gIHVwZGF0ZVVzZXJBdmF0YXIsXHJcbiAgZmV0Y2hVc2VyRGF0YUFuZENhcmRzLFxyXG59IGZyb20gJy4vYXBpLmpzJztcclxuaW1wb3J0IHsgcmVuZGVyTG9hZGluZyB9IGZyb20gJy4vdXRpbHMuanMnO1xyXG5cclxuY29uc3QgcG9wdXBQcm9maWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfZWRpdCcpO1xyXG5jb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmNvbnN0IGFkZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX19hZGQtYnV0dG9uJyk7XHJcblxyXG4vLyDQkdC70L7QuiDQvtGC0LLQtdGH0LDRjtGJ0LjQuSDQt9CwINGB0L7RhdGA0LDQvdC10L3QuNC1INC00LDQvdC90YvRhSDQsiBwb3B1cCAn0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtSDQv9GA0L7RhNC40LvRjydcclxuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fdGl0bGUnKTtcclxuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2Rlc2NyaXB0aW9uJyk7XHJcbmNvbnN0IHByb2ZpbGVGb3JtID0gZG9jdW1lbnQuZm9ybXMuZWRpdFByb2ZpbGU7XHJcbmNvbnN0IHByb2ZpbGVGb3JtTmFtZSA9IHByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW5wdXRfdHlwZV9uYW1lJyk7XHJcbmNvbnN0IHByb2ZpbGVGb3JtRGVzY3JpcHRpb24gPSBwcm9maWxlRm9ybS5xdWVyeVNlbGVjdG9yKFxyXG4gICcucG9wdXBfX2lucHV0X3R5cGVfZGVzY3JpcHRpb24nXHJcbik7XHJcblxyXG5mdW5jdGlvbiBzZXRQcm9maWxlRm9ybVZhbHVlcygpIHtcclxuICBwcm9maWxlRm9ybU5hbWUudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcclxuICBwcm9maWxlRm9ybURlc2NyaXB0aW9uLnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xyXG4gIGNvbnN0IGlucHV0RXZlbnQgPSBuZXcgRXZlbnQoJ2lucHV0JywgeyBidWJibGVzOiB0cnVlIH0pO1xyXG4gIHByb2ZpbGVGb3JtTmFtZS5kaXNwYXRjaEV2ZW50KGlucHV0RXZlbnQpO1xyXG4gIHByb2ZpbGVGb3JtRGVzY3JpcHRpb24uZGlzcGF0Y2hFdmVudChpbnB1dEV2ZW50KTtcclxufVxyXG5cclxuZnVuY3Rpb24gb3BlblByb2ZpbGVQb3B1cEJ5QnV0dG9uKCkge1xyXG4gIHNldFByb2ZpbGVGb3JtVmFsdWVzKCk7XHJcbiAgb3BlblBvcHVwKHBvcHVwUHJvZmlsZSk7XHJcbn1cclxuXHJcbmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcGVuUHJvZmlsZVBvcHVwQnlCdXR0b24pO1xyXG5cclxuLy8g0JjQt9C80LXQvdC10L3QuNC1INC/0YDQvtGE0LjQu9GPXHJcbmZ1bmN0aW9uIGNoYW5nZVByb2ZpbGUoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGV2dC50YXJnZXQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcclxuICByZW5kZXJMb2FkaW5nKHRydWUsIHNhdmVCdXR0b24pO1xyXG5cclxuICBwdXNoTXlBdXRob3JpemF0aW9uVG9TZXJ2ZXIoXHJcbiAgICBwcm9maWxlRm9ybU5hbWUudmFsdWUsXHJcbiAgICBwcm9maWxlRm9ybURlc2NyaXB0aW9uLnZhbHVlXHJcbiAgKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHByb2ZpbGVGb3JtTmFtZS52YWx1ZTtcclxuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gcHJvZmlsZUZvcm1EZXNjcmlwdGlvbi52YWx1ZTtcclxuICAgICAgY2xvc2VQb3B1cChwb3B1cFByb2ZpbGUpO1xyXG4gICAgICBwcm9maWxlRm9ybS5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDQntGI0LjQsdC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc2F2ZUJ1dHRvbik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuc2V0UHJvZmlsZUZvcm1WYWx1ZXMoKTtcclxuXHJcbi8v0JjQt9C80LXQvdC10L3QuNC1INCw0LLQsNGC0LDRgNCwINGH0LXRgNC10Lcg0L/QvtC/0LDQv1xyXG5jb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuY29uc3QgY2hhbmdlQXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2ltYWdlJyk7XHJcbmNvbnN0IHBvcHVwQ2hhbmdlQXZhdGFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX3R5cGVfbmV3LWF2YXRhcicpO1xyXG5jb25zdCBhdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXMuY2hhbmdlQXZhdGFyO1xyXG5jb25zdCBjaGFuZ2VBdmF0YXJGb3JtID0gYXZhdGFyRm9ybS5xdWVyeVNlbGVjdG9yKFxyXG4gICcucG9wdXBfX2lucHV0X3R5cGVfYXZhdGFyX3VybCdcclxuKTtcclxuXHJcbmNoYW5nZUF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuUG9wdXAocG9wdXBDaGFuZ2VBdmF0YXIpO1xyXG59KTtcclxuXHJcbmZ1bmN0aW9uIGNoYW5nZVByb2ZpbGVBdmF0YXIoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcclxuICBjb25zdCBhdmF0YXJVcmwgPSBjaGFuZ2VBdmF0YXJGb3JtLnZhbHVlO1xyXG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgc2F2ZUJ1dHRvbik7XHJcblxyXG4gIHVwZGF0ZVVzZXJBdmF0YXIoYXZhdGFyVXJsKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBwcm9maWxlSW1hZ2Uuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgnJHthdmF0YXJVcmx9JylgO1xyXG4gICAgICBjbG9zZVBvcHVwKHBvcHVwQ2hhbmdlQXZhdGFyKTtcclxuICAgICAgYXZhdGFyRm9ybS5yZXNldCgpO1xyXG4gICAgICBjbGVhclZhbGlkYXRpb24oYXZhdGFyRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICAgIHNldEV2ZW50TGlzdGVuZXJzKGF2YXRhckZvcm0sIHZhbGlkYXRpb25Db25maWcpOyBcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ9Ce0YjQuNCx0LrQsCDQv9GA0Lgg0YHQvtGF0YDQsNC90LXQvdC40Lgg0LDQstCw0YLQsNGA0LA6JywgZXJyb3IpO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc2F2ZUJ1dHRvbik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy/QodC70YPRiNCw0YLQtdC70Lgg0L3QsCDQt9Cw0LrRgNGL0YLQuNC1INGE0L7RgNC8ICsg0YHQu9GD0YjQsNGC0LXQu9GMINC/0L7RgdGC0LDQvdC+0LLQutC4INC70LDQudC60LBcclxucHJvZmlsZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgY2hhbmdlUHJvZmlsZSk7XHJcbm5ld1BsYWNlLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFkZENhcmRUb0NhcmRzQXJyYXkpO1xyXG5hdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGNoYW5nZVByb2ZpbGVBdmF0YXIpO1xyXG5cclxucG9wdXBzLmZvckVhY2goZnVuY3Rpb24gKHBvcHVwKSB7XHJcbiAgcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICBpZiAoXHJcbiAgICAgIGV2dC50YXJnZXQgPT09IGV2dC5jdXJyZW50VGFyZ2V0IHx8XHJcbiAgICAgIGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwb3B1cF9fY2xvc2UnKVxyXG4gICAgKSB7XHJcbiAgICAgIGNsb3NlUG9wdXAocG9wdXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8v0JLRi9C30L7QstGLINGE0YPQvdC60YbQuNC5INC+0YLQutGA0YvRgtC40Y8g0Lgg0LfQsNC60YDRi9GC0LjRjyDQvNC+0LTQsNC70YzQvdGL0YUg0L7QutC+0L1cclxub3BlblBvcHVwQnlCdXR0b24oYWRkQnV0dG9uLCBwb3B1cEFkZE5ld0NhcmQpO1xyXG5cclxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcclxuXHJcbmZldGNoVXNlckRhdGFBbmRDYXJkcygpXHJcbiAgLnRoZW4oKHsgdXNlckRhdGEsIGNhcmRzRGF0YSB9KSA9PiB7XHJcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHVzZXJEYXRhLm5hbWU7XHJcbiAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2VyRGF0YS5hYm91dDtcclxuICAgIHByb2ZpbGVJbWFnZS5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSB1c2VyRGF0YS5hdmF0YXI7XHJcblxyXG4gICAgYWRkQ2FyZHMoY2FyZHNEYXRhKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ9Ce0YjQuNCx0LrQsCDQv9GA0Lgg0L/QvtC70YPRh9C10L3QuNC4INC00LDQvdC90YvRhSDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y86JywgZXJyb3IpO1xyXG4gIH0pO1xyXG4iXSwibmFtZXMiOlsiZXNjQ2FsbGJhY2siLCJwb3B1cHMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJvcGVuUG9wdXAiLCJwb3B1cCIsImNsYXNzTGlzdCIsImFkZCIsImV2dCIsImtleSIsImNsb3NlUG9wdXAiLCJjbG9zZVBvcGFwRXNjIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjdXJyZW50VXNlcklkIiwicG9wdXBJbWFnZSIsInF1ZXJ5U2VsZWN0b3IiLCJwb3B1cEltYWdlSW1hZ2UiLCJwb3B1cEltYWdlQ2FwdGlvbiIsImJhc2VVcmwiLCJjb25maWciLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsImNoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0IiwiY29uY2F0Iiwic3RhdHVzIiwicmVxdWVzdCIsInVybCIsIm9wdGlvbnMiLCJmZXRjaCIsInRoZW4iLCJsaWtlQ2FyZE9uU2VydmVyIiwiY2FyZElkIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkaXNMaWtlQ2FyZE9uU2VydmVyIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ1dHRvbiIsImNvbnRhaW5zIiwiYnV0dG9uVGV4dCIsInRleHRDb250ZW50IiwiY2FyZHNPblBhZ2UiLCJwb3B1cEFkZE5ld0NhcmQiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwibmV3UGxhY2UiLCJmb3JtcyIsInBsYWNlTmFtZSIsInBsYWNlTGluayIsImNyZWF0ZUNhcmQiLCJwbGFjZSIsImRlbGV0ZUZ1bmN0aW9uIiwibGlrZUZ1bmN0aW9uIiwiY2FyZEl0ZW0iLCJjbG9uZU5vZGUiLCJkZWxldGVCdXR0b24iLCJjYXJkSW1hZ2UiLCJjYXJkVGl0bGUiLCJjYXJkTGlrZUJ1dHRvbiIsIm51bWJlck9mTGlrZXMiLCJfaWQiLCJkYXRhc2V0Iiwib3duZXIiLCJzdHlsZSIsImRpc3BsYXkiLCJsaWtlcyIsInNvbWUiLCJ1c2VyIiwic3JjIiwibGluayIsImFsdCIsIm5hbWUiLCJsZW5ndGgiLCJkZWxldGVDYXJkIiwiY2FyZFRvUmVtb3ZlIiwidGFyZ2V0IiwiY2xvc2VzdCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImxpa2VDYXJkIiwiY3VycmVudENhcmQiLCJjYXJkVG9MaWtlIiwiaXNMaWtlZCIsInVwZGF0ZWRDYXJkIiwidG9nZ2xlIiwidmFsaWRhdGlvbkNvbmZpZyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiZXJyb3JTZWxlY3RvciIsImlucHV0SWQiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiZXJyb3JFbGVtZW50IiwiaWQiLCJzZXRFdmVudExpc3RlbmVycyIsImlucHV0TGlzdCIsIkFycmF5IiwiZnJvbSIsImJ1dHRvbkVsZW1lbnQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImZvckVhY2giLCJ2YWxpZGl0eSIsInBhdHRlcm5NaXNtYXRjaCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZXJyb3JNZXNzYWdlIiwidmFsaWQiLCJzaG93SW5wdXRFcnJvciIsInZhbGlkYXRpb25NZXNzYWdlIiwiY2hlY2tJbnB1dFZhbGlkaXR5IiwiaGFzSW52YWxpZElucHV0IiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwicG9wdXBQcm9maWxlIiwiZWRpdEJ1dHRvbiIsImFkZEJ1dHRvbiIsInByb2ZpbGVOYW1lIiwicHJvZmlsZURlc2NyaXB0aW9uIiwicHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZSIsInByb2ZpbGVGb3JtTmFtZSIsInByb2ZpbGVGb3JtRGVzY3JpcHRpb24iLCJzZXRQcm9maWxlRm9ybVZhbHVlcyIsInZhbHVlIiwiaW5wdXRFdmVudCIsIkV2ZW50IiwiYnViYmxlcyIsImRpc3BhdGNoRXZlbnQiLCJwcm9maWxlSW1hZ2UiLCJjaGFuZ2VBdmF0YXJCdXR0b24iLCJwb3B1cENoYW5nZUF2YXRhciIsImF2YXRhckZvcm0iLCJjaGFuZ2VBdmF0YXIiLCJjaGFuZ2VBdmF0YXJGb3JtIiwicHJldmVudERlZmF1bHQiLCJkZXNjcmlwdGlvbiIsInNhdmVCdXR0b24iLCJhYm91dCIsInJlc2V0IiwiZmluYWxseSIsImNhcmROYW1lIiwiY2FyZExpbmsiLCJzdWJtaXR0ZXIiLCJhZGRlZENhcmQiLCJuZXdQbGFjZUNhcmQiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwiZXJyb3IiLCJhdmF0YXJVcmwiLCJhdmF0YXIiLCJ1cGRhdGVVc2VyQXZhdGFyIiwiYmFja2dyb3VuZEltYWdlIiwiY2xlYXJWYWxpZGF0aW9uIiwiY3VycmVudFRhcmdldCIsImV2ZW50IiwiZW5hYmxlVmFsaWRhdGlvbiIsImFsbCIsInJlc3VsdCIsIl9yZWYiLCJfcmVmMiIsInVzZXJEYXRhIiwiY2FyZHNEYXRhIiwiY2FyZCIsImFwcGVuZENoaWxkIiwiYWRkQ2FyZHMiXSwic291cmNlUm9vdCI6IiJ9